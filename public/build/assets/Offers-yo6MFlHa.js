import{R as e,r as i}from"./FilterContainer-TykbAVkI.js";import{c as M}from"./ReactAppend-GBOQKLDe.js";import{C as q}from"./CreateReactScript-Il069F1S.js";import{m as x}from"./SelectAPIFormGroup-A251JnnE.js";import{S as N}from"./OfferCard-Wbn3Y7Zw.js";import{T as C,a as O}from"./arrayJoin-Fk5sgFcM.js";import"./TippyButton-w0wM3ydO.js";import{R as P}from"./OfferForm-ukR-vBLm.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-Hm6EbMAE.js";import"./axios-_sX4vCAy.js";import"./index-VFMbf6KQ.js";const D=({item:r,offers:u,setOffers:m,onOpenModalClicked:p})=>{const n=r.products.sort((t,o)=>{var s,f;return(((s=o==null?void 0:o.pivot)==null?void 0:s.isParent)||0)-(((f=t==null?void 0:t.pivot)==null?void 0:f.isParent)||0)}).slice(0,4).map(t=>t.producto),c=r.products.length,g=async t=>{const{isConfirmed:o}=await N.fire({title:"Eliminar Oferta",text:`¿Estás seguro de que deseas eliminar la oferta "${r.producto}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(o)try{const{status:s,result:f}=await x.Fetch(`/api/offers/${t}`,{method:"DELETE"});if(!s)throw new Error((f==null?void 0:f.message)??"Ocurrió un error al eliminar la oferta.");N.fire("¡Eliminado!","La oferta ha sido eliminada correctamente.","success");const h=structuredClone(u).filter(k=>k.id!==t);m(h)}catch(s){N.fire("¡Error!",s.message,"error")}},b=async(t,o)=>{$(t.target).parents('[id^="dropdown-menu-"]').addClass("hidden").removeClass("block"),p(o)};return e.createElement("li",{key:`offer-${r.id}`},e.createElement("div",{className:"inline-flex items-center justify-between w-[300px] p-5 text-gray-500 bg-white border-2 border-gray-200 rounded-lg dark:border-gray-700 peer-checked:border-blue-600  dark:peer-checked:text-gray-300 peer-checked:text-gray-600  dark:text-gray-400 dark:bg-gray-800"},e.createElement("div",{className:"block w-full"},e.createElement("div",{className:"flex items-center justify-between w-full"},e.createElement("h4",{className:"flex gap-2"},e.createElement("span",{className:"text-[#006BF6] text-[16.45px] font-bold text-xl"},"S/. ",r.descuento>0?r.descuento:r.precio),r.descuento>0&&e.createElement("span",{className:"text-sm text-[#15294C] opacity-60 line-through"},r.precio)),e.createElement("div",null,e.createElement("button",{id:`dropdown-button-${r.id}`,"data-dropdown-toggle":`dropdown-menu-${r.id}`,className:"inline-flex items-center p-2 text-sm font-medium text-center text-gray-900 bg-white rounded-lg outline-none dark:text-white dark:bg-gray-800",type:"button"},e.createElement("i",{className:"fas fa-ellipsis-v"})),e.createElement("div",{id:`dropdown-menu-${r.id}`,className:"z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dark:divide-gray-600"},e.createElement("ul",{className:"py-2 text-sm text-gray-700 dark:text-gray-200","aria-labelledby":"dropdownMenuIconButton"},e.createElement("li",null,e.createElement("a",{"data-dropdown-hide":`dropdown-menu-${r.id}`,className:"block cursor-pointer px-4 py-2 hover:bg-gray-600 dark:hover:bg-gray-100",onClick:t=>b(t,r)},"Ver productos")),e.createElement("li",null,e.createElement("a",{"data-dropdown-hide":`dropdown-menu-${r.id}`,className:"block cursor-pointer px-4 py-2 hover:bg-gray-600 dark:hover:bg-gray-100",onClick:()=>g(r.id)},"Eliminar")))))),e.createElement("div",{className:"w-full text-lg font-semibold"},r.producto),e.createElement("hr",{className:"my-2"}),e.createElement("div",{className:"w-full text-sm h-20 overflow-hidden"},c>0?n.map((t,o)=>o>=3&&c>4?e.createElement("p",{key:`product-${o}`,className:"w-full text-nowrap overflow-hidden text-ellipsis"},c-3," productos mas"):e.createElement("p",{key:`product-${o}`,className:"w-full text-nowrap overflow-hidden text-ellipsis"},o==0?e.createElement("b",null,t):t)):e.createElement("i",{className:"text-gray-400"},"- No hay productos asociados -")))))},S=({onClick:r=()=>{},onRemoveClicked:u,radioName:m=null,isParent:p=!1,...n})=>{const c=Number(n.descuento)||0,g=Number(n.precio)||0,b=c>0?c:g;return e.createElement("a",{href:"#",className:"flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 w-full",onClick:t=>r(t,n)},e.createElement("div",{className:"flex-shrink-0"},e.createElement("img",{className:"rounded-md w-11 h-11",src:`/${n.imagen}`,alt:"Robert image",onError:t=>t.target.src="/images/img/noimagen.jpg"})),e.createElement("div",{className:"w-full ps-3"},e.createElement("div",{className:"text-gray-500 text-sm mb-1.5 dark:text-gray-400 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,textOverflow:"ellipsis",WebkitBoxOrient:"vertical",height:"40px"}},m&&e.createElement(C,{content:"Marcar como producto principal"},e.createElement("input",{className:"mx-1 cursor-pointer",type:"radio",name:m,defaultChecked:p,value:n.id,required:!0})),e.createElement("span",{className:"font-semibold text-gray-900 dark:text-white"},n.sku&&e.createElement("span",{class:"bg-blue-100 text-blue-800 text-xs font-medium me-1 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300"},n.sku),n.producto)," ",n.description||e.createElement("i",{className:"text-gray-400"},"- Sin Descripcion -")),e.createElement("div",{className:"text-xs font-semibold text-blue-600 dark:text-blue-500"},"S/. ",b.toFixed(2))),u&&e.createElement("div",{className:"flex-shrink-0 ps-3"},e.createElement("i",{className:"fa fa-trash cursor-pointer",onClick:()=>u(n.id)})))},J={content:{width:"400px",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:"calc(100vh - 140px)"}},z=({data:r,setData:u,refreshOffers:m})=>{let p=new AbortController;const n=i.useRef(),c=i.useRef(),g=i.useRef(),b=i.useRef(),t=i.useRef(),o=i.useRef(),[s,f]=i.useState([]),[h,k]=i.useState([]),[F,E]=i.useState(!1),[w,R]=i.useState(!1),v=s.reduce((l,a)=>(Number(a.descuento)||0)>0?l+Number(a.descuento):l+Number(a.precio),0);i.useEffect(()=>{r!=null?E(!0):E(!1),console.log("temrino de cargar")},[r]);const T=async l=>{l.preventDefault();try{const{status:a,result:d}=await x.Fetch("/api/offers",{method:"PATCH",body:x.JSON.stringify({id:n.current.value,producto:c.current.value,precio:v,descuento:b.current.value,parent_id:$('input[name="isParent"]:checked').val()??null,products:structuredClone(s).map(({id:y})=>y)})});if(!a)throw new Error((d==null?void 0:d.message)??"Ocurrio un error al guardar el combo");E(!1),u(null),m()}catch(a){Swal.fire("¡Error!",a.message,"error")}},j=()=>{n.current.value=(r==null?void 0:r.id)??"",c.current.value=(r==null?void 0:r.producto)??"",b.current.value=(r==null?void 0:r.descuento)??0,g.current.value=v??0,f((r==null?void 0:r.products)??[])},A=async()=>{p.abort("Nothing");const l=[[O([["products.producto","contains",o.current.value],["products.sku","contains",o.current.value]],"or")]];s.length>0&&l.push("and",["!",O(s.map(({id:L})=>["products.id","=",L]))]),p=new AbortController;const a=p.signal,d=await fetch("/api/products/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(Cookies.get("XSRF-TOKEN"))},body:x.JSON.stringify({filter:l}),signal:a}),y=x.JSON.parseable(await d.text());d.ok?k(y.data):k([])},B=async(l,a)=>{l.preventDefault();const d=structuredClone(s);d.push(a),f(d),o.current.value="",R(!1)},I=async l=>{const a=structuredClone(s).filter(({id:d})=>d!=l);f(a)};return e.createElement(P,{isOpen:F,style:J,onAfterOpen:j,onRequestClose:()=>u(null)},e.createElement("form",{onSubmit:T},e.createElement("input",{type:"hidden",name:"id",ref:n,value:r==null?void 0:r.id}),e.createElement("div",{className:"flex flex-row items-center justify-between gap-2 mb-2"},e.createElement("h4",{className:"text-lg font-semibold"},r!=null&&r.id?"Actualizar combo":"Nuevo combo"),e.createElement("div",{className:"flex gap-1"},e.createElement("button",{type:"submit",className:"px-3 py-2 text-xs font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},e.createElement("i",{className:"fa fa-save"})),e.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-medium text-center text-white bg-red-700 rounded-lg hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",onClick:()=>E(!1)},e.createElement("i",{className:"fa fa-times"})))),e.createElement("div",{className:"w-full grid grid-cols-2 gap-4"},e.createElement("div",{className:"col-span-2"},e.createElement("label",{htmlFor:"offer-name",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Nombre del combo"),e.createElement("input",{ref:c,type:"text",id:"offer-name","aria-describedby":"helper-text-explanation",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Ej. Combo gamer",required:!0})),e.createElement("div",null,e.createElement("label",{htmlFor:"offer-precio",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Precio total"),e.createElement("input",{ref:g,type:"number",id:"offer-precio","aria-describedby":"helper-text-explanation",className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 cursor-not-allowed dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"0.00",step:.01,disabled:!0,value:v,required:!0})),e.createElement("div",null,e.createElement("label",{htmlFor:"offer-oferta",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Precio del combo"),e.createElement(C,{content:"Este precio se le cobrara al cliente al llevar el combo"},e.createElement("input",{ref:b,type:"number",id:"offer-oferta","aria-describedby":"helper-text-explanation",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"0.00",step:.01,required:!0})))),e.createElement("hr",{className:"my-4"}),e.createElement("div",{className:"relative flex flex-col items-center justify-between gap-2"},e.createElement("h4",{className:"text-lg font-normal"},"Lista de productos"),e.createElement("button",{type:"button","data-dropdown-toggle":"dropdownResults",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-3 py-1 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700",onClick:()=>R(!w)},w?e.createElement("i",{className:"fa fa-times me-1"}):e.createElement("i",{className:" fa fa-plus me-1"}),w?"Ocultar":"Agregar"),e.createElement("div",{ref:t,id:"dropdownResults",className:`z-20 ${w?"block":"hidden"} absolute top-20 w-full max-w-sm bg-white divide-y divide-gray-100 rounded-lg dark:bg-gray-800 dark:divide-gray-700`,"aria-labelledby":"dropdownResultsButton",style:{boxShadow:"0 0 10px rgba(0, 0, 0, .25)"}},e.createElement("div",{className:"block p-2 font-medium text-center text-gray-700 rounded-t-lg bg-gray-50 dark:bg-gray-800 dark:text-white"},e.createElement("input",{ref:o,type:"text",id:"small-input",className:"block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Buscar producto",onChange:A})),e.createElement("div",{className:"divide-y divide-gray-100 dark:divide-gray-700"},h.length>0?h.map((l,a)=>e.createElement(S,{key:`result-${a}`,...l,onClick:B})):e.createElement("i",{className:"block text-gray-400 m-2 max-w-max mx-auto"},"- No hay resultados -"))),e.createElement("div",null,s.sort((l,a)=>{var d,y;return(((d=a==null?void 0:a.pivot)==null?void 0:d.isParent)||0)-(((y=l==null?void 0:l.pivot)==null?void 0:y.isParent)||0)}).map((l,a)=>e.createElement(S,{key:`item-${a}`,...l,radioName:"isParent",isParent:a==0,onRemoveClicked:I}))))))};P.setAppElement("body");const X=({offers:r})=>{const u=i.useRef(),[m,p]=i.useState(r),[n,c]=i.useState(null),g=t=>{c(t)},b=async()=>{location.reload()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"p-8 flex flex-col gap-6 justify-center items-center min-h-[calc(100vh-64px)] bg-gray-100"},e.createElement(C,{content:"Agregar combo"},e.createElement("button",{type:"button",className:"text-blue-700 border border-blue-700 hover:bg-blue-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-4 text-center inline-flex items-center dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:focus:ring-blue-800 dark:hover:bg-blue-500",onClick:g},e.createElement("i",{className:"fa fa-plus"}))),e.createElement("ul",{className:"flex flex-wrap w-full gap-6 items-center justify-center"},m.length>0&&m.map((t,o)=>e.createElement(D,{key:o,item:t,setItem:c,onOpenModalClicked:g,offers:m,setOffers:p})))),e.createElement(z,{eRef:u,data:n,setData:c,refreshOffers:b}))};q((r,u)=>{M(r).render(e.createElement(X,{...u}))});
